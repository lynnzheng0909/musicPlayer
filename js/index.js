var controlManager,songList,len,root=window.player,$scope=$(document.body),audio=new root.audioControl,status="pause",index=0;function bindEvent(){$scope.on("play:change",function(o,t){root.render(songList[t]),root.process.renderAllTime(songList[t]),root.process.update(),audio.getAudio(songList[t].audio),"play"==status&&(audio.play(),root.process.start())}),$scope.on("tap",".prev-btn",function(){root.process.stop(),index=controlManager.prev(),$scope.trigger("play:change",index)}),$scope.on("tap",".next-btn",function(){root.process.stop(),index=controlManager.next(),$scope.trigger("play:change",index)}),$scope.on("tap",".play-btn",function(){"pause"==audio.status?(audio.play(),root.process.start(),status="play",$(".play-btn").addClass("playing")):(audio.pause(),root.process.stop(),status="pause",$(".play-btn").removeClass("playing"))})}function bindTouch(){var o=$scope.find(".slider-pointer"),t=$scope.find(".pro-wrapper").offset(),e=t.left,a=t.width;o.on("touchstart",function(){root.process.stop()}).on("touchmove",function(o){var t=(o.changedTouches[0].clientX-e)/a;t<0?t=0:1<t&&(t=1),root.process.update(t)}).on("touchend",function(o){var t=(o.changedTouches[0].clientX-e)/a;t<0?t=0:1<t&&(t=1);var n=t*songList[controlManager.index].duration;audio.playTo(n),status="play",root.process.changeLastPer(t),root.process.start(),$scope.find(".play-btn").addClass("playing")})}function getData(o){$.ajax({type:"GET",url:o,success:function(o){len=(songList=o).length,root.render(o[0]),controlManager=new root.controlManager(0,len),bindEvent(),bindTouch(),$scope.trigger("play:change",index)},error:function(){}})}getData("../mock/data.json");